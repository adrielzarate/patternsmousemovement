<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Canvas</title>
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        canvas {
            border: black solid thin;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script>

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const canvasW = canvas.width = window.innerWidth;
        const canvasH = canvas.height = window.innerHeight;
        const patterns = [];

        let mouseX;
        let mouseY;

        //--//
        const init = { x: 20, y: 200 };
        // const end = { x: 200, y: 20 };
        const end = { x: mouseX, y: mouseY };
        const units = 20;
        // const unitX = (end.x - init.x) / units;
        // const unitY = (end.y - init.y) / units;
        let unitX;
        let unitY;
        const dots = [];

        let dotX = init.x;
        let dotY = init.y;

        function Dot(x, y) {
            this.x = x;
            this.y = y;
        }

        Dot.prototype.draw = function(x, y) {
            this.x = x;
            this.y = y;
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, 2 * Math.PI);
            ctx.stroke();
        };

        for(let i = 0; i <= units; i++) {
            dots.push(new Dot());
        }

        function drawLine() {
            ctx.beginPath();
            ctx.strokeStyle = '#fff';
            ctx.moveTo(init.x, init.y);
            ctx.lineTo(end.x, end.y);
            ctx.stroke();

            ctx.strokeStyle = '#000';

            for(let i = 0; i <= units; i++) {
                dots[i].draw(dotX, dotY);
                dotX += unitX;
                dotY += unitY;
            }
        }

        // drawLine();

        // for(let i = 0; i <= units; i++) {
        //     dots.push(new Dot());
        // //     dots[i].draw(dotX, dotY);
        // //     dotX += unitX;
        // //     dotY += unitY;
        // }

        //--//

        function Pattern(x, y, w, h) {
            this.x = x;
            this.y = y;
            this.w = 1;
            this.h = 1;
            this.maxW = w;
            this.maxH = h;
        }

        Pattern.prototype.draw = function() {
            ctx.beginPath();
            ctx.rect(this.x, this.y, this.w, this.h);
            ctx.stroke();
        }

        Pattern.prototype.grow = function() {
            if(this.w < this.maxW) {
                this.w += 2;
            }
            if(this.h < this.maxH) {
                this.h += 2;
            }
        }

        Pattern.prototype.initSize = function() {
            if(this.w > 1) {
                this.w -= .2;
            }
            if(this.h > 1) {
                this.h -= .2;
            }
        }

        function createPatterns(nXItems, nYItems) {

            let xItems = canvasW/nXItems;
            let yItems = canvasH/nYItems;
            let posX = 0;
            let posY = 0;

            for(let i = 0; i < nXItems; i++) {
                posY = 0;
                for(let j = 0; j < nYItems; j++) {
                    patterns.push(new Pattern(posX, posY, xItems, yItems));
                    posY += yItems;
                }
                posX += xItems;
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvasW, canvasH);

            for(let i = 0; i < patterns.length; i++) {

                // if( mouseX > patterns[i].x - patterns[i].maxW
                //  && mouseX < patterns[i].x + patterns[i].maxW * 2
                //  && mouseY > patterns[i].y - patterns[i].maxH
                //  && mouseY < patterns[i].y + patterns[i].maxH * 2
                // ) {
                //     patterns[i].grow();
                // } else {
                //     patterns[i].initSize();
                // }

                for(let j = 0; j < units; j++) {
                    if(    dots[j].x > patterns[i].x
                        && dots[j].x < patterns[i].x + patterns[i].maxW
                        && dots[j].y > patterns[i].y
                        && dots[j].y < patterns[i].y + patterns[i].maxH
                    ) {
                        patterns[i].grow();
                    } else {
                        patterns[i].initSize();
                    }
                }

                patterns[i].draw();

            }
        }

        createPatterns(100, 50);

        function anim() {
            dotX = init.x;
            dotY = init.y;
            draw();
            drawLine();
            window.requestAnimationFrame(anim);
        }
        window.requestAnimationFrame(anim);

        canvas.addEventListener('mousemove', function(e) {

            end.x = mouseX = e.pageX;
            end.y = mouseY = e.pageY;

            unitX = (end.x - init.x) / units;
            unitY = (end.y - init.y) / units;
 
        });

    </script>
</body>

</html>
